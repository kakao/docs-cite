<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Design-rsses on Cite Documents</title>
    <link>http://tech.kakao.com/citedocs/design/index.xml</link>
    <description>Recent content in Design-rsses on Cite Documents</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Released under the Apache License 2.0</copyright>
    <atom:link href="http://tech.kakao.com/citedocs/design/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Design</title>
      <link>http://tech.kakao.com/citedocs/design/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://tech.kakao.com/citedocs/design/</guid>
      <description>

&lt;h2 id=&#34;create&#34;&gt;Create&lt;/h2&gt;

&lt;div id=&#39;app_create&#39; type=&#34;sequence_diagram&#34;&gt;
participant User
participant Cite
participant kubernetes
participant elasticsearch
participant Github

User-&gt;Cite: create app
Cite-&gt;kubernetes: upsert kubernetes namespace
Cite-&gt;elasticsearch: upsert kibana index
Cite-&gt;Github: upsert github webhook
Cite-&gt;Github: add cite user as collaborator
Cite-&gt;kubernetes: upsert kubernetes service
&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;create new service on cite webUI&lt;/li&gt;
&lt;li&gt;create/update kubernetes namespace&lt;/li&gt;
&lt;li&gt;create/update kibana index on elasticsearch for Pod log&lt;/li&gt;
&lt;li&gt;register cite webhook on github repository&lt;/li&gt;
&lt;li&gt;add cite account as a collaborator on github repository for source checkout, commit status update, deployment create, deployment status update&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;build&#34;&gt;Build&lt;/h2&gt;

&lt;h3 id=&#34;automatic&#34;&gt;Automatic&lt;/h3&gt;

&lt;div id=&#39;app_build_auto&#39; type=&#34;sequence_diagram&#34;&gt;
Title: cite auto build

participant User
participant GitHub
participant Buildbot
participant DockerReg
participant Cite

User-&gt;GitHub: git push
GitHub-&gt;Buildbot: webhook for push event
Buildbot-&gt;GitHub: update commit status : pending
GitHub-&gt;Cite: webhook for status event
Cite-&gt;User: notification for build start
Buildbot-&gt;Buildbot: build docker image
Buildbot-&gt;DockerReg: push docker image
Buildbot-&gt;GitHub: update commit status : success
GitHub-&gt;Cite: webhook for status event
Cite-&gt;User: notification for build end
&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;git push to github&lt;/li&gt;
&lt;li&gt;github executes webhook : push event&lt;/li&gt;
&lt;li&gt;buildbot 이 github 의 commit status 업데이트 : pending&lt;/li&gt;
&lt;li&gt;github 이 status event 에 대한 webhook (cite API) 요청&lt;/li&gt;
&lt;li&gt;cite 가 사용자에게 빌드 시작 알림&lt;/li&gt;
&lt;li&gt;buildbot 이 docker image build&lt;/li&gt;
&lt;li&gt;buildbot 이 docker registry 로 image push&lt;/li&gt;
&lt;li&gt;buildbot 이 github 의 commit status 업데이트 : success or failure&lt;/li&gt;
&lt;li&gt;github 이 status event 에 대한 webhook (cite API) 요청&lt;/li&gt;
&lt;li&gt;cite 가 사용자에게 빌드 결과(성공 or 실패) 알림&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;manual&#34;&gt;Manual&lt;/h3&gt;

&lt;div id=&#39;app_build_manual&#39; type=&#34;sequence_diagram&#34;&gt;
Title: cite manual build

participant User
participant Cite
participant GitHub
participant Buildbot
participant DockerReg

User-&gt;Cite: build
Cite-&gt;Buildbot: github &#39;cite&#39; event
Buildbot-&gt;GitHub: update commit status : pending
GitHub-&gt;Cite: webhook for status event
Cite-&gt;User: notification for build start
Buildbot-&gt;Buildbot: build docker image
Buildbot-&gt;DockerReg: push docker image
Buildbot-&gt;GitHub: update commit status : success
GitHub-&gt;Cite: webhook for status event
Cite-&gt;User: notification for build end
&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;cite UI 에서 build 또는 rebuild 버튼 클릭&lt;/li&gt;
&lt;li&gt;cite 가 buildbot 으로 custom github event 전송

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;X-GitHub-Event: cite&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;buildbot 이 github 의 commit status 업데이트 : pending&lt;/li&gt;
&lt;li&gt;github 이 status event 에 대한 webhook (cite API) 요청&lt;/li&gt;
&lt;li&gt;cite 가 사용자에게 빌드 시작 알림&lt;/li&gt;
&lt;li&gt;buildbot 이 docker image build&lt;/li&gt;
&lt;li&gt;buildbot 이 docker registry로 image push&lt;/li&gt;
&lt;li&gt;buildbot 이 github 의 commit status 업데이트 : success or failure&lt;/li&gt;
&lt;li&gt;github 이 status event 에 대한 webhook (cite API) 요청&lt;/li&gt;
&lt;li&gt;cite 가 사용자에게 빌드 결과(성공 or 실패) 알림&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;deployment&#34;&gt;Deployment&lt;/h2&gt;

&lt;h3 id=&#34;automatic-1&#34;&gt;Automatic&lt;/h3&gt;

&lt;div id=&#39;app_deploy_auto&#39; type=&#34;sequence_diagram&#34;&gt;
Title: cite auto deploy

participant GitHub
participant Cite
participant Kubernetes

GitHub-&gt;Cite: github status event : success
Cite-&gt;GitHub: create deployment
Cite-&gt;GitHub: create deployment status : pending
Cite-&gt;Kubernetes: create replication controller
Cite-&gt;Kubernetes: update service
Cite-&gt;GitHub: create deployment status : success
&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;github 이 status event 에 대한 webhook (cite API) 요청&lt;/li&gt;
&lt;li&gt;cite 가 github 에 deployment 생성&lt;/li&gt;
&lt;li&gt;cite 가 github 에 deployment status 생성 : pending&lt;/li&gt;
&lt;li&gt;Kubernetes replication controller 생성&lt;/li&gt;
&lt;li&gt;Kubernetes service의 selector 갱신&lt;/li&gt;
&lt;li&gt;cite 가 github 에 deployment status 생성 : success&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;manual-1&#34;&gt;Manual&lt;/h3&gt;

&lt;div id=&#39;app_deploy_manual&#39; type=&#34;sequence_diagram&#34;&gt;
Title: cite manual deploy

participant User
participant GitHub
participant Cite
participant Kubernetes

User-&gt;Cite: deploy request
Cite-&gt;GitHub: create deployment
Cite-&gt;GitHub: create deployment status : pending
Cite-&gt;Kubernetes: create replication controller
Cite-&gt;Kubernetes: update service
Cite-&gt;GitHub: create deployment status : success
&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;cite UI 에서 deploy버튼 클릭&lt;/li&gt;
&lt;li&gt;cite 가 github 에 deployment 생성&lt;/li&gt;
&lt;li&gt;cite 가 github 에 deployment status 생성 : pending&lt;/li&gt;
&lt;li&gt;Kubernetes replication controller 생성&lt;/li&gt;
&lt;li&gt;Kubernetes service의 selector 갱신&lt;/li&gt;
&lt;li&gt;cite 가 github 에 deployment status 생성 : success&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Components</title>
      <link>http://tech.kakao.com/citedocs/design/components/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://tech.kakao.com/citedocs/design/components/</guid>
      <description>

&lt;h2 id=&#34;components&#34;&gt;Components&lt;/h2&gt;

&lt;h3 id=&#34;cite-https-github-daumkakao-com-ctf-cite&#34;&gt;&lt;a href=&#34;https://github.daumkakao.com/CTF/cite&#34;&gt;cite&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;cite web frontend 및 github의 요청을 처리하는 API 서버. google developer console에 대응&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;service metadata 설정&lt;/li&gt;
&lt;li&gt;service 생성/삭제&lt;/li&gt;
&lt;li&gt;pod 상태 조회&lt;/li&gt;
&lt;li&gt;배포/롤백&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;cite-watcher-https-github-daumkakao-com-ctf-cite-watcher&#34;&gt;&lt;a href=&#34;https://github.daumkakao.com/CTF/cite-watcher&#34;&gt;cite-watcher&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;kubernetes ingress관련 이벤트 처리.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;domain update&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;cite-batch-https-github-daumkakao-com-ctf-cite-batch&#34;&gt;&lt;a href=&#34;https://github.daumkakao.com/CTF/cite-batch&#34;&gt;cite-batch&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;batch성 작업 모음&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;garbage collect : 사용되지 않는 replication controller 삭제&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;external-components&#34;&gt;External Components&lt;/h2&gt;

&lt;h3 id=&#34;etcd&#34;&gt;etcd&lt;/h3&gt;

&lt;p&gt;cite의 main storage. cite configuration, kubernetes metadata, fleet metadata, cite metadata 및 loadbalancer endpoint 관리&lt;/p&gt;

&lt;h3 id=&#34;kubernetes&#34;&gt;kubernetes&lt;/h3&gt;

&lt;p&gt;container pod, replication controller, service 등 관리. replication controller가 container instance개수 유지&lt;/p&gt;

&lt;h3 id=&#34;elasticsearch-kibana&#34;&gt;elasticsearch + kibana&lt;/h3&gt;

&lt;p&gt;kubernetes POD의 로그 수집, kubernetes 및 cite 자체 로그 수집&lt;/p&gt;

&lt;h3 id=&#34;jenkins&#34;&gt;jenkins&lt;/h3&gt;

&lt;p&gt;배치 작업 처리&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;etcd backup&lt;/li&gt;
&lt;li&gt;elasticsearch cleanup : 오래된 앱 로그 및 배포 로그 삭제&lt;/li&gt;
&lt;li&gt;service health check&lt;/li&gt;
&lt;li&gt;kubernetes node lvs 상태 보고&lt;/li&gt;
&lt;li&gt;cite-batch로 사용되지 않는 replication controller삭제&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;supplement-components&#34;&gt;Supplement Components&lt;/h2&gt;

&lt;h3 id=&#34;ansible&#34;&gt;ansible&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;cite 및 kubernetes 설치, 업데이트&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;docker-registry&#34;&gt;docker-registry&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;docker image 호스팅&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;fluentd&#34;&gt;fluentd&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;pod 및 cite 로그 수집&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>